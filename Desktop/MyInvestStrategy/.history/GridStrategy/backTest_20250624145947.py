import numpy as np
import pandas as pd
import calKDJ as kdj

def backTest(file_path, amount, windows, total_shares):
    '''
    回测
    :param file_path: 数据文件路径
    :param amount: 初始资金
    :param windows: 窗口大小
    :param total_shares: 投入总份数
    :return:回测结果
    '''
    #data = pd.read_csv(file_path)
    #data_list = kdj.cal_KDJ(data, 9, 3, 3)

    df = pd.DataFrame(file_path, columns=['date', 'j_value', 'price', 'high_price', 'low_price'])
    df['date'] = pd.to_datetime(df['date'])
    df = df.sort_values('date').reset_index(drop=True)

    # 初始化变量
    cash = amount # 手上还有的现金
    shares_held = 0 # 手上持有的份数
    portfolio_value = cash # 投资组合的价值
    max_investment = 0 # 最大投入金额
    peak_value = cash
    max_drawdown = 0 # 最大回撤


    trade_history = [] # 记录交易历史
    buy_prices = [] # 记录买入价格

    # 记录买入/卖出窗口
    buy_window = pd.Timedelta(days=windows)
    sell_window = pd.Timedelta(days=windows)

    for i in range(len(df)):
        current_date = df.at[i, 'date']
        j_value = df.at[i, 'j_value']
        price = df.at[i, 'price']

        # 检查窗口内是否有交易
        recent_buy = False
        recent_sell = False

        for trade in trade_history:
            if (current_date - trade['date']) <= buy_window and trade['type'] == 'buy':
                    recent_buy = True
            if (current_date - trade['date']) <= sell_window and trade['type'] == 'sell':
                    recent_sell = True
        
        # 买入逻辑 ---------------------------------》这里可以添加上其他的策略作为限制条件，看回测效果如何
        if not recent_buy and shares_held < total_shares:
            buy_shares = 0
            if j_value <= -15:
                buy_shares = 1

            elif j_value <= -10:
                buy_shares = 1

            elif j_value <= -8:
                buy_shares = 1

            elif j_value <= -5:
                buy_shares = 1

            if buy_shares > 0 and cash >= price * buy_shares:
                cost = price * buy_shares
                cash -= cost
                shares_held += buy_shares
                buy_prices.append(price) # 每次满足条件的买入都放到list里
                trade_history.append({'date': current_date, 'type': 'buy', 'shares': buy_shares, 'price': price}) # 'cost':cost

        # 卖出逻辑 ---------------------------------》这里可以添加上其他的策略作为限制条件，看回测效果如何
        if not recent_sell and shares_held >= 0 and len(buy_prices) > 0:
            sell_shares = 0
            if j_value >= 110:
                sell_shares = 1

            elif j_value >= 100:
                sell_shares = 1

            elif j_value >= 90:
                sell_shares = 1

            elif j_value >= 80:
                sell_shares = 1
            
            # 检查当前价格是否大于 最近买入价格？未卖出价格？ price > buy_prices.max() price > buy_prices.min() price > buy_prices[-1]?
            if sell_shares > 0 and shares_held >= sell_shares and price > min(buy_prices):
                revenue = price * sell_shares
                cash += revenue
                shares_held -= sell_shares
                min_price = min(buy_prices)
                # 移除已买入的价格中最小的买入价格记录
                buy_prices.remove(min_price) if len(buy_prices) > 0 else None
                trade_history.append({'date': current_date, 'type': 'sell', 'shares': sell_shares, 'price': price, 'buy_prices':buy_prices}) # , 'revenue':revenue                

        # 更新投资组合价值
        portfolio_value = cash + shares_held * price

        # 更新最大投入金额
        current_investment = amount - cash
        if current_investment > max_investment:
            max_investment = current_investment
        
        # 更新最大回撤
        if portfolio_value > peak_value:
            peak_value = portfolio_value
        else:
            drawdown = (peak_value - portfolio_value) / peak_value
            if drawdown > max_drawdown:
                max_drawdown = drawdown
        
    # 计算最终结果
    final_value = cash + shares_held * df.iloc[-1]['price']
    total_return = (final_value - amount) / amount

    # 整理交易历史
    trade_history_df = pd.DataFrame(trade_history)

    result = {
        'amount':amount,
        'final_value': final_value,
        'total_return': total_return,
        'max_drawdown': max_drawdown,
        'max_investment': max_investment,
        'trade_history': trade_history_df,
        'portfolio_value_over_time': portfolio_value}

    buy_list = []
    sell_list = []
    for key, value in result.items():
        print(f"{key}: {value}", type(value))
        if key == 'trade_history':
            for index, row in value.iterrows():
                if row['type'] == 'buy':
                    buy_list.append([row['date'], row['price']])
                elif row['type'] == 'sell':
                    sell_list.append([row['date'], row['price']])

    i = 0 # sell的索引
    j = 0 # buy的索引
    earnings_result = []
    # 1、遍历sell_list和buy_list，用第一个sell匹配第一个小于sell的buy---[0.300990099009901, 0.04072589153829933, 0.03575794621026895, 0.009447466361293993, 0.016192071468453455, 0.12130862767805443]
    while i < len(sell_list) and j < len(buy_list):
        if (sell_list[i][1] > buy_list[j][1]) and (sell_list[i][0] > buy_list[j][0]): # 限制价格的同时要限制住日期，不能出现sell的日期小于buy的日期
            print(f'当前位置为 sell：{i} buy：{j}，sell对应的价格为{sell_list[i][1]}, buy对应的价格为{buy_list[j][1]}')
            earnings_yield = (sell_list[i][1] - buy_list[j][1]) / buy_list[j][1]
            earnings_result.append(earnings_yield)
            
            # 移除这两个元素
            sell_list.pop(i)
            buy_list.pop(j)

            # 更新索引
            i = 0
            j = 0
        elif (sell_list[i][1] < buy_list[j][1]) and (sell_list[i][0] > buy_list[j][0]):
            # 当前Buy值太大，尝试下一个Buy值
            j += 1
            # 如果已经到达Buy列表的末尾，则移动到下一个sell值
            if j >= len(buy_list):
                i += 1
                j = 0
        
    print(earnings_result)
    return result

sample_data = [
    ['2020-03-18', -8.28, 3.351, 3.346, 3.483], ['2020-05-22', -11.94, 3.535, 3.533, 3.618], ['2020-05-25', -8.809, 3.537, 3.517, 3.549], ['2020-09-09', -5.122, 4.365, 4.335, 4.43], ['2020-09-10', -7.284, 4.369, 4.354, 4.426], ['2021-02-26', -13.08, 5.121, 5.113, 5.212], ['2021-03-01', -5.974, 5.21, 5.14, 5.212], ['2021-03-02', -7.501, 5.141, 5.099, 5.243], ['2021-04-13', -10.036, 4.739, 4.721, 4.786], ['2021-04-14', -5.323, 4.767, 4.735, 4.781], ['2021-09-16', -7.934, 4.681, 4.673, 4.747], ['2021-12-21', -8.723, 4.771, 4.741, 4.784], ['2021-12-22', -7.875, 4.774, 4.762, 4.796], ['2022-01-28', -6.606, 4.421, 4.417, 4.526], ['2022-03-08', -9.586, 4.131, 4.115, 4.238], ['2022-04-25', -5.014, 3.68, 3.674, 3.826], ['2022-04-26', -8.299, 3.65, 3.641, 3.74], ['2022-07-12', -13.358, 4.219, 4.205, 4.274], ['2022-07-13', -10.123, 4.226, 4.195, 4.246], ['2022-07-14', -5.779, 4.227, 4.203, 4.256], ['2022-07-15', -11.636, 4.162, 4.16, 4.267], ['2022-09-20', -6.884, 3.858, 3.847, 3.89], ['2022-09-21', -7.659, 3.828, 3.81, 3.857], ['2022-09-22', -8.52, 3.799, 3.787, 3.831], ['2022-10-28', -7.009, 3.471, 3.462, 3.55], ['2022-10-31', -8.28, 3.432, 3.419, 3.483], ['2022-12-21', -8.711, 3.76, 3.749, 3.778], ['2023-02-07', -5.726, 4.021, 4.001, 4.032], ['2023-02-08', -11.704, 4.004, 3.996, 4.04], ['2023-03-10', -8.76, 3.892, 3.89, 3.935], ['2023-04-24', -7.307, 3.91, 3.894, 3.963], ['2023-04-25', -6.937, 3.891, 3.855, 3.919], ['2023-04-26', -7.257, 3.882, 3.865, 3.901], ['2023-08-11', -5.509, 3.881, 3.879, 3.979], ['2023-08-14', -5.386, 3.854, 3.815, 3.863], ['2023-08-16', -9.809, 3.82, 3.818, 3.853], ['2023-08-18', -5.648, 3.783, 3.782, 3.845], ['2023-08-21', -8.199, 3.731, 3.728, 3.785], ['2023-10-19', -5.487, 3.531, 3.526, 3.591], ['2024-01-09', -7.027, 3.288, 3.27, 3.302], ['2024-01-10', -10.406, 3.272, 3.263, 3.312], ['2024-03-27', -12.819, 3.493, 3.492, 3.532], ['2024-05-30', -7.869, 3.596, 3.588, 3.625], ['2024-05-31', -11.774, 3.582, 3.58, 3.616], ['2024-07-25', -9.966, 3.459, 3.441, 3.476], ['2024-07-26', -6.324, 3.474, 3.452, 3.483], ['2024-07-29', -11.208, 3.454, 3.453, 3.472], ['2024-07-30', -11.625, 3.431, 3.417, 3.446], ['2024-10-17', -7.645, 3.863, 3.862, 3.96], ['2024-12-17', -7.985, 4.007, 3.991, 4.043], ['2025-01-06', -5.774, 3.853, 3.828, 3.873], ['2025-05-27', -8.417, 3.946, 3.939, 3.969], ['2025-05-28', -14.005, 3.942, 3.938, 3.956],
    ['2020-01-13', 99.832, 3.922, 3.861, 3.925], ['2020-01-14', 88.009, 3.904, 3.9, 3.942], ['2020-02-13', 97.447, 3.67, 3.658, 3.705], ['2020-02-14', 108.511, 3.697, 3.663, 3.715], ['2020-02-17', 114.405, 3.784, 3.706, 3.79], ['2020-02-18', 107.917, 3.759, 3.732, 3.782], ['2020-02-19', 101.399, 3.76, 3.749, 3.789], ['2020-02-20', 103.746, 3.851, 3.759, 3.864], ['2020-02-21', 97.859, 3.865, 3.837, 3.898], ['2020-02-24', 82.9, 3.832, 3.802, 3.856], ['2020-03-05', 90.237, 3.92, 3.831, 3.928], ['2020-03-06', 82.582, 3.841, 3.837, 3.889], ['2020-03-31', 81.66, 3.389, 3.38, 3.426], ['2020-04-01', 80.497, 3.393, 3.374, 3.443], ['2020-04-02', 94.549, 3.443, 3.361, 3.448], ['2020-04-03', 89.639, 3.417, 3.403, 3.444], ['2020-04-07', 99.836, 3.5, 3.478, 3.513], ['2020-04-08', 96.343, 3.485, 3.472, 3.499], ['2020-04-09', 98.537, 3.496, 3.49, 3.508], ['2020-04-10', 86.115, 3.484, 3.466, 3.532], ['2020-04-14', 87.668, 3.525, 3.475, 3.528], ['2020-04-15', 86.422, 3.503, 3.501, 3.534], ['2020-04-16', 82.106, 3.505, 3.486, 3.517], ['2020-04-20', 88.46, 3.555, 3.533, 3.556], ['2020-04-29', 82.22, 3.571, 3.543, 3.585], ['2020-04-30', 95.452, 3.628, 3.583, 3.636], ['2020-05-06', 101.511, 3.638, 3.58, 3.646], ['2020-05-07', 100.31, 3.631, 3.619, 3.645], ['2020-05-08', 98.783, 3.673, 3.647, 3.692], ['2020-05-11', 88.944, 3.666, 3.655, 3.712], ['2020-05-12', 83.304, 3.665, 3.637, 3.68], ['2020-05-13', 83.406, 3.674, 3.64, 3.68], ['2020-06-01', 85.466, 3.688, 3.615, 3.696], ['2020-06-02', 106.435, 3.699, 3.68, 3.709], ['2020-06-03', 103.864, 3.698, 3.696, 3.74], ['2020-06-04', 100.896, 3.7, 3.685, 3.715], ['2020-06-05', 104.986, 3.723, 3.685, 3.724], ['2020-06-08', 103.397, 3.742, 3.732, 3.767], ['2020-06-09', 109.166, 3.769, 3.733, 3.77], ['2020-06-10', 107.569, 3.76, 3.747, 3.766], ['2020-06-11', 85.371, 3.723, 3.704, 3.77], ['2020-06-18', 87.602, 3.773, 3.725, 3.775], ['2020-06-19', 93.766, 3.825, 3.77, 3.845], ['2020-06-22', 92.307, 3.829, 3.817, 3.86], ['2020-06-23', 98.237, 3.848, 3.806, 3.853], ['2020-06-24', 104.072, 3.884, 3.856, 3.887], ['2020-06-29', 92.794, 3.848, 3.826, 3.88], ['2020-06-30', 95.428, 3.898, 3.866, 3.912], ['2020-07-01', 100.64, 3.992, 3.903, 3.996], ['2020-07-02', 102.786, 4.09, 3.983, 4.095], ['2020-07-03', 103.016, 4.177, 4.089, 4.184], ['2020-07-06', 102.274, 4.504, 4.228, 4.519], ['2020-07-07', 91.489, 4.456, 4.444, 4.57], ['2020-07-08', 92.153, 4.518, 4.428, 4.558], ['2020-07-09', 96.779, 4.592, 4.48, 4.604], ['2020-07-10', 89.788, 4.505, 4.483, 4.577], ['2020-07-13', 92.368, 4.605, 4.497, 4.647], ['2020-07-14', 88.17, 4.562, 4.485, 4.619], ['2020-08-03', 92.659, 4.545, 4.492, 4.549], ['2020-08-04', 102.236, 4.549, 4.524, 4.583], ['2020-08-05', 105.583, 4.551, 4.481, 4.565], ['2020-08-06', 100.87, 4.533, 4.467, 4.572], ['2020-08-07', 81.287, 4.485, 4.42, 4.525], ['2020-08-18', 88.818, 4.59, 4.564, 4.612], ['2020-09-18', 86.972, 4.531, 4.413, 4.533], ['2020-09-21', 80.176, 4.476, 4.47, 4.57], ['2020-10-12', 86.834, 4.607, 4.483, 4.613], ['2020-10-13', 109.915, 4.623, 4.58, 4.634], ['2020-10-14', 112.306, 4.599, 4.583, 4.617], ['2020-10-15', 107.504, 4.587, 4.578, 4.621], ['2020-10-16', 99.056, 4.573, 4.544, 4.612], ['2020-10-19', 83.831, 4.542, 4.524, 4.64], ['2020-10-20', 83.009, 4.572, 4.527, 4.574], ['2020-11-04', 91.397, 4.593, 4.55, 4.615], ['2020-11-05', 107.923, 4.669, 4.62, 4.673], ['2020-11-06', 111.732, 4.671, 4.628, 4.682], ['2020-11-09', 109.139, 4.768, 4.7, 4.794], ['2020-11-10', 99.627, 4.741, 4.712, 4.783], ['2020-11-11', 82.421, 4.694, 4.689, 4.748], ['2020-11-23', 80.731, 4.792, 4.729, 4.825], ['2020-12-01', 84.261, 4.862, 4.746, 4.87], ['2020-12-02', 91.595, 4.851, 4.828, 4.885], ['2020-12-03', 93.449, 4.849, 4.823, 4.867], ['2020-12-04', 97.0, 4.86, 4.8, 4.867], ['2020-12-07', 82.683, 4.816, 4.797, 4.862], ['2020-12-21', 99.727, 4.83, 4.755, 4.841], ['2020-12-23', 83.097, 4.794, 4.757, 4.818], ['2020-12-24', 81.073, 4.794, 4.77, 4.817], ['2020-12-25', 97.88, 4.836, 4.763, 4.839], ['2020-12-28', 92.778, 4.85, 4.823, 4.88], ['2020-12-30', 96.042, 4.898, 4.827, 4.9], ['2020-12-31', 102.894, 5.007, 4.906, 5.013], ['2021-01-04', 99.796, 5.054, 4.98, 5.086], ['2021-01-05', 102.429, 5.153, 5.025, 5.165], ['2021-01-06', 100.006, 5.202, 5.137, 5.234], ['2021-01-07', 103.318, 5.319, 5.203, 5.32], ['2021-01-08', 95.702, 5.291, 5.239, 5.351], ['2021-01-11', 82.149, 5.228, 5.197, 5.34], ['2021-01-12', 93.177, 5.388, 5.212, 5.392], ['2021-01-13', 89.164, 5.366, 5.33, 5.435], ['2021-01-25', 85.676, 5.423, 5.323, 5.441], ['2021-02-08', 90.787, 5.346, 5.274, 5.365], ['2021-02-09', 108.519, 5.484, 5.342, 5.486], ['2021-02-10', 112.106, 5.599, 5.489, 5.625], ['2021-02-18', 93.109, 5.556, 5.54, 5.725], ['2021-02-19', 84.212, 5.588, 5.463, 5.593], ['2021-03-31', 86.32, 4.842, 4.805, 4.876], ['2021-04-01', 106.293, 4.904, 4.844, 4.912], ['2021-04-02', 115.371, 4.953, 4.901, 4.958], ['2021-04-06', 107.055, 4.925, 4.912, 4.969], ['2021-04-07', 91.464, 4.89, 4.859, 4.932], ['2021-04-08', 80.811, 4.901, 4.849, 4.922], ['2021-04-20', 80.59, 4.873, 4.854, 4.908], ['2021-04-21', 99.189, 4.885, 4.839, 4.9], ['2021-04-22', 104.383, 4.881, 4.857, 4.91], ['2021-04-23', 111.797, 4.932, 4.873, 4.942], ['2021-04-26', 86.269, 4.868, 4.863, 4.983], ['2021-04-29', 91.893, 4.965, 4.912, 4.972], ['2021-05-17', 90.532, 4.98, 4.909, 5.007], ['2021-05-18', 103.235, 4.982, 4.959, 5.004], ['2021-05-19', 103.692, 4.968, 4.945, 4.988], ['2021-05-20', 105.802, 4.982, 4.944, 4.998], ['2021-05-21', 87.728, 4.927, 4.915, 5.019], ['2021-05-24', 82.017, 4.955, 4.888, 4.956], ['2021-05-25', 96.113, 5.119, 4.955, 5.13], ['2021-05-26', 99.449, 5.12, 5.108, 5.145], ['2021-05-27', 93.343, 5.139, 5.088, 5.186], ['2021-05-28', 85.701, 5.124, 5.092, 5.165], ['2021-05-31', 83.148, 5.13, 5.082, 5.131], ['2021-06-01', 83.886, 5.138, 5.063, 5.142], ['2021-06-25', 86.745, 5.062, 4.983, 5.081], ['2021-06-28', 108.519, 5.071, 5.049, 5.082], ['2021-06-29', 95.959, 5.017, 5.007, 5.071], ['2021-06-30', 99.145, 5.048, 5.017, 5.059], ['2021-07-01', 98.029, 5.046, 5.014, 5.076], ['2021-07-15', 90.655, 4.999, 4.916, 5.006], ['2021-07-16', 81.296, 4.948, 4.944, 4.997], ['2021-07-19', 85.966, 4.97, 4.898, 4.98], ['2021-07-20', 80.67, 4.957, 4.923, 4.971], ['2021-07-21', 91.474, 4.996, 4.964, 5.017], ['2021-07-22', 90.809, 5.001, 4.99, 5.025], ['2021-08-06', 86.564, 4.785, 4.754, 4.797], ['2021-08-09', 102.765, 4.84, 4.744, 4.859], ['2021-08-10', 112.661, 4.897, 4.794, 4.9], ['2021-08-11', 104.541, 4.87, 4.867, 4.916], ['2021-08-12', 90.326, 4.838, 4.828, 4.873], ['2021-09-02', 83.917, 4.737, 4.712, 4.76], ['2021-09-06', 94.59, 4.794, 4.706, 4.808], ['2021-09-07', 101.79, 4.857, 4.778, 4.881], ['2021-09-08', 97.059, 4.836, 4.82, 4.885], ['2021-09-09', 92.809, 4.834, 4.794, 4.835], ['2021-09-10', 94.901, 4.883, 4.826, 4.919], ['2021-09-13', 86.895, 4.856, 4.827, 4.901], ['2021-10-08', 92.231, 4.798, 4.763, 4.807], ['2021-10-11', 91.19, 4.797, 4.793, 4.852], ['2021-10-25', 88.463, 4.845, 4.803, 4.853], ['2021-10-26', 81.651, 4.828, 4.815, 4.88], ['2021-11-12', 95.773, 4.762, 4.746, 4.783], ['2021-11-15', 101.294, 4.756, 4.735, 4.783], ['2021-11-16', 98.042, 4.752, 4.742, 4.788], ['2021-11-17', 94.004, 4.751, 4.733, 4.766], ['2021-11-19', 82.97, 4.762, 4.697, 4.768], ['2021-11-22', 94.73, 4.775, 4.759, 4.787], ['2021-11-23', 96.566, 4.778, 4.758, 4.792], ['2021-11-24', 92.578, 4.789, 4.766, 4.808], ['2021-12-07', 88.787, 4.794, 4.77, 4.801], ['2021-12-08', 105.746, 4.866, 4.781, 4.871], ['2021-12-09', 103.067, 4.95, 4.868, 4.996], ['2021-12-10', 96.227, 4.935, 4.915, 4.942], ['2021-12-13', 89.431, 4.948, 4.941, 5.019], ['2022-02-18', 97.863, 4.511, 4.462, 4.512], ['2022-02-21', 96.032, 4.494, 4.472, 4.504], ['2022-03-21', 90.279, 4.119, 4.079, 4.147], ['2022-03-22', 96.049, 4.115, 4.098, 4.149], ['2022-03-23', 103.286, 4.14, 4.107, 4.153], ['2022-03-24', 103.51, 4.113, 4.08, 4.137], ['2022-03-25', 84.69, 4.036, 4.034, 4.121], ['2022-04-01', 85.401, 4.136, 4.052, 4.156], ['2022-04-06', 90.442, 4.124, 4.095, 4.136], ['2022-05-12', 82.175, 3.818, 3.8, 3.846], ['2022-05-13', 87.866, 3.849, 3.819, 3.866], ['2022-05-17', 89.816, 3.867, 3.816, 3.868], ['2022-05-18', 90.978, 3.853, 3.827, 3.884], ['2022-05-19', 93.669, 3.862, 3.803, 3.864], ['2022-05-20', 104.763, 3.946, 3.877, 3.947], ['2022-05-23', 94.4, 3.914, 3.888, 3.946], ['2022-05-31', 80.082, 3.956, 3.883, 3.97], ['2022-06-01', 92.722, 3.95, 3.927, 3.963], ['2022-06-02', 102.852, 3.961, 3.925, 3.965], ['2022-06-06', 110.228, 4.043, 3.932, 4.044], ['2022-06-07', 106.881, 4.049, 4.022, 4.069], ['2022-06-08', 108.001, 4.091, 4.032, 4.097], ['2022-06-09', 95.208, 4.057, 4.04, 4.101], ['2022-06-10', 98.147, 4.115, 4.025, 4.127], ['2022-06-13', 82.42, 4.063, 4.037, 4.09], ['2022-06-14', 85.629, 4.103, 3.982, 4.107], ['2022-06-21', 81.11, 4.207, 4.172, 4.245], ['2022-06-23', 83.127, 4.232, 4.151, 4.234], ['2022-06-24', 94.084, 4.28, 4.23, 4.293], ['2022-06-27', 91.287, 4.328, 4.296, 4.366], ['2022-06-28', 97.061, 4.38, 4.3, 4.393], ['2022-06-29', 84.553, 4.325, 4.31, 4.394], ['2022-06-30', 85.521, 4.375, 4.32, 4.412], ['2022-07-01', 81.562, 4.36, 4.341, 4.392], ['2022-07-04', 87.934, 4.388, 4.316, 4.39], ['2022-07-05', 83.244, 4.378, 4.329, 4.432], ['2022-08-11', 86.938, 4.121, 4.043, 4.127], ['2022-08-12', 105.944, 4.122, 4.105, 4.133], ['2022-08-15', 100.24, 4.112, 4.105, 4.153], ['2022-08-16', 89.11, 4.102, 4.094, 4.139], ['2022-08-17', 99.95, 4.143, 4.078, 4.154], ['2022-08-18', 83.191, 4.106, 4.101, 4.141], ['2022-09-09', 82.346, 4.026, 3.973, 4.034], ['2022-09-13', 98.237, 4.04, 4.029, 4.062], ['2022-09-14', 80.836, 3.994, 3.981, 4.022], ['2022-10-14', 80.007, 3.77, 3.71, 3.79], ['2022-10-17', 98.37, 3.769, 3.736, 3.773], ['2022-10-18', 102.687, 3.762, 3.754, 3.797], ['2022-10-19', 82.501, 3.703, 3.701, 3.769], ['2022-11-04', 97.449, 3.701, 3.571, 3.718], ['2022-11-07', 110.679, 3.701, 3.676, 3.722], ['2022-11-08', 108.698, 3.678, 3.654, 3.71], ['2022-11-09', 94.97, 3.638, 3.634, 3.691], ['2022-11-10', 80.957, 3.617, 3.594, 3.633], ['2022-11-11', 87.718, 3.715, 3.677, 3.765], ['2022-11-14', 80.301, 3.717, 3.707, 3.786], ['2022-11-15', 95.424, 3.792, 3.702, 3.801], ['2022-11-16', 91.142, 3.763, 3.758, 3.805], ['2022-11-17', 80.441, 3.746, 3.702, 3.753], ['2022-11-30', 93.06, 3.778, 3.762, 3.794], ['2022-12-01', 94.989, 3.823, 3.822, 3.877], ['2022-12-02', 87.871, 3.8, 3.798, 3.831], ['2022-12-05', 102.722, 3.871, 3.824, 3.874], ['2022-12-06', 104.858, 3.894, 3.855, 3.917], ['2022-12-07', 98.254, 3.882, 3.867, 3.933], ['2022-12-08', 95.91, 3.891, 3.87, 3.9], ['2022-12-09', 100.3, 3.925, 3.875, 3.936], ['2022-12-12', 81.403, 3.883, 3.879, 3.912], ['2023-01-03', 94.924, 3.816, 3.757, 3.828], ['2023-01-04', 104.849, 3.821, 3.798, 3.832], ['2023-01-05', 113.744, 3.896, 3.839, 3.902], ['2023-01-06', 111.025, 3.912, 3.893, 3.929], ['2023-01-09', 108.756, 3.937, 3.919, 3.953], ['2023-01-10', 106.056, 3.943, 3.929, 3.959], ['2023-01-11', 98.973, 3.943, 3.936, 3.972], ['2023-01-12', 96.611, 3.949, 3.935, 3.962], ['2023-01-13', 101.863, 4.011, 3.956, 4.015], ['2023-01-16', 94.965, 4.074, 4.014, 4.115], ['2023-01-17', 88.4, 4.07, 4.053, 4.083], ['2023-01-19', 82.683, 4.089, 4.034, 4.091], ['2023-01-20', 90.053, 4.112, 4.096, 4.125], ['2023-01-30', 80.52, 4.136, 4.129, 4.198], ['2023-03-03', 86.963, 4.055, 4.025, 4.067], ['2023-03-06', 82.317, 4.03, 4.011, 4.058], ['2023-03-23', 104.857, 3.962, 3.909, 3.963], ['2023-03-24', 115.537, 3.957, 3.945, 3.965], ['2023-03-27', 102.61, 3.936, 3.915, 3.956], ['2023-03-28', 87.831, 3.928, 3.921, 3.949], ['2023-03-30', 99.315, 3.971, 3.912, 3.972], ['2023-03-31', 100.797, 3.981, 3.97, 3.994], ['2023-04-03', 100.9, 4.011, 3.976, 4.022], ['2023-04-04', 106.081, 4.031, 4.003, 4.033], ['2023-04-06', 99.784, 4.019, 4.004, 4.024], ['2023-04-07', 98.417, 4.048, 4.017, 4.06], ['2023-04-10', 89.201, 4.033, 4.029, 4.06], ['2023-04-18', 85.99, 4.083, 4.067, 4.094], ['2023-06-12', 80.086, 3.779, 3.756, 3.801], ['2023-06-13', 105.013, 3.808, 3.768, 3.811], ['2023-06-14', 100.242, 3.808, 3.806, 3.835], ['2023-06-15', 112.484, 3.873, 3.811, 3.874], ['2023-06-16', 113.54, 3.91, 3.88, 3.919], ['2023-06-19', 100.635, 3.88, 3.875, 3.91], ['2023-06-20', 90.059, 3.873, 3.867, 3.89], ['2023-07-13', 86.657, 3.885, 3.841, 3.888], ['2023-07-14', 97.26, 3.883, 3.881, 3.895], ['2023-07-17', 80.266, 3.855, 3.839, 3.877], ['2023-07-26', 90.175, 3.907, 3.892, 3.913], ['2023-07-27', 93.962, 3.903, 3.891, 3.929], ['2023-07-28', 106.671, 3.999, 3.884, 4.006], ['2023-07-31', 97.786, 4.015, 4.005, 4.072], ['2023-08-01', 86.742, 3.997, 3.986, 4.036], ['2023-10-30', 80.621, 3.583, 3.551, 3.594], ['2023-10-31', 100.679, 3.575, 3.553, 3.581], ['2023-11-01', 100.314, 3.573, 3.563, 3.611], ['2023-11-02', 89.734, 3.556, 3.555, 3.6], ['2023-11-03', 94.872, 3.584, 3.561, 3.599], ['2023-11-06', 106.994, 3.632, 3.605, 3.636], ['2023-11-07', 105.872, 3.621, 3.607, 3.632], ['2023-11-08', 96.646, 3.61, 3.589, 3.627], ['2023-11-09', 84.253, 3.613, 3.6, 3.626], ['2023-12-28', 93.537, 3.42, 3.331, 3.429], ['2023-12-29', 111.292, 3.43, 3.413, 3.436], ['2024-01-02', 94.109, 3.384, 3.382, 3.433], ['2024-01-25', 103.389, 3.335, 3.261, 3.34], ['2024-01-26', 107.604, 3.329, 3.312, 3.35], ['2024-01-29', 94.683, 3.299, 3.298, 3.345], ['2024-02-07', 95.224, 3.34, 3.287, 3.342], ['2024-02-08', 109.736, 3.362, 3.333, 3.366], ['2024-02-19', 115.31, 3.389, 3.355, 3.392], ['2024-02-20', 115.749, 3.401, 3.372, 3.405], ['2024-02-21', 105.796, 3.449, 3.382, 3.496], ['2024-02-22', 104.536, 3.475, 3.441, 3.477], ['2024-02-23', 103.196, 3.478, 3.464, 3.497], ['2024-02-26', 92.194, 3.443, 3.437, 3.482], ['2024-02-27', 94.785, 3.484, 3.433, 3.486], ['2024-02-29', 84.289, 3.503, 3.437, 3.507], ['2024-03-01', 91.354, 3.53, 3.495, 3.54], ['2024-03-04', 93.023, 3.527, 3.508, 3.537], ['2024-03-05', 94.178, 3.556, 3.508, 3.566], ['2024-03-06', 83.564, 3.542, 3.538, 3.572], ['2024-03-11', 85.953, 3.581, 3.53, 3.584], ['2024-03-12', 91.572, 3.586, 3.568, 3.599], ['2024-04-02', 88.13, 3.572, 3.561, 3.587], ['2024-04-03', 85.237, 3.558, 3.548, 3.572], ['2024-04-18', 84.037, 3.559, 3.541, 3.594], ['2024-04-29', 87.22, 3.616, 3.572, 3.638], ['2024-04-30', 85.633, 3.598, 3.596, 3.624], ['2024-05-06', 97.31, 3.648, 3.635, 3.664], ['2024-05-07', 102.672, 3.65, 3.637, 3.656], ['2024-05-08', 90.98, 3.621, 3.618, 3.644], ['2024-05-09', 99.611, 3.656, 3.619, 3.662], ['2024-05-10', 101.205, 3.658, 3.631, 3.67], ['2024-05-13', 98.36, 3.655, 3.619, 3.666], ['2024-05-14', 87.46, 3.649, 3.638, 3.67], ['2024-07-11', 86.139, 3.509, 3.477, 3.519], ['2024-07-12', 106.251, 3.519, 3.505, 3.524], ['2024-07-15', 114.198, 3.526, 3.508, 3.531], ['2024-07-16', 116.832, 3.551, 3.517, 3.555], ['2024-07-17', 110.915, 3.556, 3.54, 3.57], ['2024-07-18', 112.246, 3.577, 3.532, 3.579], ['2024-07-19', 109.823, 3.6, 3.552, 3.606], ['2024-07-22', 91.137, 3.571, 3.551, 3.598], ['2024-09-23', 82.469, 3.283, 3.263, 3.3], ['2024-09-24', 111.957, 3.427, 3.293, 3.429], ['2024-09-25', 107.809, 3.474, 3.467, 3.544], ['2024-09-26', 118.737, 3.64, 3.467, 3.643], ['2024-09-27', 115.047, 3.869, 3.67, 3.933], ['2024-09-30', 117.146, 4.233, 3.876, 4.24], ['2024-10-08', 103.45, 4.412, 4.208, 4.656], ['2024-10-28', 82.916, 4.046, 4.0, 4.047], ['2024-11-05', 84.264, 4.137, 4.01, 4.139], ['2024-11-06', 83.596, 4.111, 4.085, 4.18], ['2024-11-07', 103.631, 4.248, 4.076, 4.25], ['2024-11-08', 91.347, 4.194, 4.178, 4.29], ['2024-11-11', 88.459, 4.215, 4.13, 4.219], ['2024-12-03', 86.439, 4.035, 4.005, 4.052], ['2024-12-04', 84.311, 4.014, 4.003, 4.041], ['2024-12-05', 85.179, 4.007, 3.994, 4.022], ['2024-12-06', 94.363, 4.057, 4.006, 4.085], ['2024-12-09', 96.112, 4.054, 4.03, 4.08], ['2024-12-25', 80.022, 4.072, 4.054, 4.094], ['2024-12-26', 93.946, 4.073, 4.056, 4.079], ['2024-12-27', 92.105, 4.067, 4.061, 4.099], ['2024-12-30', 101.674, 4.086, 4.065, 4.093], ['2025-01-17', 87.974, 3.898, 3.868, 3.922], ['2025-01-20', 95.059, 3.917, 3.908, 3.949], ['2025-01-21', 98.97, 3.922, 3.905, 3.941], ['2025-01-22', 80.951, 3.886, 3.868, 3.916], ['2025-01-24', 82.279, 3.929, 3.883, 3.943], ['2025-02-10', 86.714, 3.992, 3.974, 4.0], ['2025-02-11', 83.264, 3.976, 3.963, 3.998], ['2025-02-12', 98.164, 4.014, 3.96, 4.019], ['2025-02-13', 92.317, 4.004, 3.998, 4.034], ['2025-02-14', 100.577, 4.034, 3.997, 4.04], ['2025-02-17', 101.305, 4.041, 4.012, 4.053], ['2025-02-18', 85.867, 4.012, 3.996, 4.058], ['2025-02-19', 83.172, 4.033, 4.0, 4.041], ['2025-02-21', 85.548, 4.075, 4.02, 4.08], ['2025-02-24', 81.85, 4.062, 4.041, 4.089], ['2025-03-14', 88.33, 4.106, 4.01, 4.113], ['2025-03-17', 90.875, 4.094, 4.088, 4.123], ['2025-03-18', 93.797, 4.103, 4.091, 4.115], ['2025-03-19', 97.623, 4.109, 4.084, 4.121], ['2025-04-17', 102.574, 3.863, 3.841, 3.871], ['2025-04-18', 112.317, 3.873, 3.847, 3.879], ['2025-04-21', 113.088, 3.875, 3.857, 3.886], ['2025-04-22', 103.222, 3.878, 3.873, 3.893], ['2025-04-23', 90.833, 3.882, 3.873, 3.907], ['2025-04-24', 81.667, 3.882, 3.871, 3.903], ['2025-05-08', 80.177, 3.95, 3.918, 3.966], ['2025-05-09', 83.534, 3.945, 3.932, 3.95], ['2025-05-12', 99.121, 3.99, 3.957, 3.992], ['2025-05-13', 97.839, 3.994, 3.988, 4.012], ['2025-05-14', 97.502, 4.045, 3.992, 4.066], ['2025-05-15', 83.316, 4.011, 4.004, 4.041], ['2025-06-09', 92.31, 3.995, 3.984, 4.01], ['2025-06-11', 85.066, 4.004, 3.974, 4.024], ['2025-06-12', 90.671, 4.006, 3.98, 4.013]
    ]
results = backTest(sample_data, 20000, 30, 10)